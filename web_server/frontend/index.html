<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Robot Live Stream</title>
<style>
    body { text-align: center; font-family: sans-serif; background: #111; color: #eee; }
    img {
        width: 80vw;
        max-width: 100%;
        height: auto;
        border: 2px solid #555;
        border-radius: 6px;
        margin-top: 20px;
        }
    #status { margin-top: 10px; font-size: 1.1em; }
</style>
<script src="https://cdn.jsdelivr.net/npm/roslib/build/roslib.min.js"></script>
</head>
<body>
<h1>Robot Camera</h1>
<div>
  <img id="stream" src="" alt="Waiting for stream..." />
</div>
<div id="status">Connecting...</div>
<div style="margin-top:20px;">
  <input type="text" id="promptInput" placeholder="Enter prompts, comma-separated" style="width:300px;">
  <button id="sendPrompt">Send Prompt</button>
</div>

<script>
const imgEl = document.getElementById('stream');
const statusEl = document.getElementById('status');
const promptInput = document.getElementById('promptInput');
const sendPromptBtn = document.getElementById('sendPrompt');

const rosbridgeUrl = 'wss://intermeasurable-unbearably-sondra.ngrok-free.dev'
const ros = new ROSLIB.Ros({ url: rosbridgeUrl });

ros.on('connection', () => statusEl.textContent = 'Connected to ROS');
ros.on('error', (err) => statusEl.textContent = 'Error connecting');
ros.on('close', () => statusEl.textContent = 'Connection closed');

const cameraTopic = new ROSLIB.Topic({
  ros: ros,
  name: '/camera/annotated/compressed',
  messageType: 'sensor_msgs/CompressedImage'
});

cameraTopic.subscribe((msg) => {
  if (!msg.data) return;
  imgEl.src = 'data:image/jpeg;base64,' + msg.data;
});

const promptTopic = new ROSLIB.Topic({
    ros: ros,
    name: '/prompt/input',
    messageType: 'std_msgs/String'
});

sendPromptBtn.onclick = () => {
    const msg = new ROSLIB.Message({ data: promptInput.value });
    promptTopic.publish(msg);
};
</script>
</body>
</html>