<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Robot Live Stream</title>
<style>
    body { text-align: center; font-family: sans-serif; background: #111; color: #eee; }
    img {
        width: 80vw;
        max-width: 100%;
        height: auto;
        border: 2px solid #555;
        border-radius: 6px;
        margin-top: 20px;
        }
    #status { margin-top: 10px; font-size: 1.1em; }
</style>
<script src="https://cdn.jsdelivr.net/npm/roslib/build/roslib.min.js"></script>
</head>
<body>
<h1>Robot Camera</h1>
<div style="text-align:center;">
  <img id="stream" src="" alt="Waiting for stream..." />
</div>
<div id="status">Connecting...</div>

<script>
const imgEl = document.getElementById('stream');
const statusEl = document.getElementById('status');

const rosbridgeUrl = "{{ROSBRIDGE_URL}}" || 'ws://localhost:9090';
const ros = new ROSLIB.Ros({
  url: rosbridgeUrl
});

ros.on('connection', () => statusEl.textContent = 'Connected to ROS');
ros.on('error', (err) => statusEl.textContent = 'Error connecting');
ros.on('close', () => statusEl.textContent = 'Connection closed');

const imageTopic = new ROSLIB.Topic({
  ros: ros,
  name: '/camera/image_raw',
  messageType: 'sensor_msgs/Image'
});

imageTopic.subscribe((msg) => {
  if (!msg.data) return;

  // Convert ROS base64 to image
  const imgSrc = 'data:image/jpeg;base64,' + msg.data;
  imgEl.src = imgSrc;
});
</script>
</body>
</html>